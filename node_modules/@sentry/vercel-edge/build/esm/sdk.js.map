{"version":3,"file":"sdk.js","sources":["../../src/sdk.ts"],"sourcesContent":["import {\n  dedupeIntegration,\n  functionToStringIntegration,\n  getIntegrationsToSetup,\n  inboundFiltersIntegration,\n  initAndBind,\n  linkedErrorsIntegration,\n  requestDataIntegration,\n} from '@sentry/core';\nimport type { Client, Integration, Options } from '@sentry/types';\nimport { GLOBAL_OBJ, createStackParser, nodeStackLineParser, stackParserFromStackParserOptions } from '@sentry/utils';\n\nimport { setAsyncLocalStorageAsyncContextStrategy } from './async';\nimport { VercelEdgeClient } from './client';\nimport { winterCGFetchIntegration } from './integrations/wintercg-fetch';\nimport { makeEdgeTransport } from './transports';\nimport type { VercelEdgeClientOptions, VercelEdgeOptions } from './types';\nimport { getVercelEnv } from './utils/vercel';\n\ndeclare const process: {\n  env: Record<string, string>;\n};\n\nconst nodeStackParser = createStackParser(nodeStackLineParser());\n\n/** Get the default integrations for the browser SDK. */\nexport function getDefaultIntegrations(options: Options): Integration[] {\n  return [\n    dedupeIntegration(),\n    inboundFiltersIntegration(),\n    functionToStringIntegration(),\n    linkedErrorsIntegration(),\n    winterCGFetchIntegration(),\n    ...(options.sendDefaultPii ? [requestDataIntegration()] : []),\n  ];\n}\n\n/** Inits the Sentry NextJS SDK on the Edge Runtime. */\nexport function init(options: VercelEdgeOptions = {}): Client | undefined {\n  setAsyncLocalStorageAsyncContextStrategy();\n\n  if (options.defaultIntegrations === undefined) {\n    options.defaultIntegrations = getDefaultIntegrations(options);\n  }\n\n  if (options.dsn === undefined && process.env.SENTRY_DSN) {\n    options.dsn = process.env.SENTRY_DSN;\n  }\n\n  if (options.tracesSampleRate === undefined && process.env.SENTRY_TRACES_SAMPLE_RATE) {\n    const tracesSampleRate = parseFloat(process.env.SENTRY_TRACES_SAMPLE_RATE);\n    if (isFinite(tracesSampleRate)) {\n      options.tracesSampleRate = tracesSampleRate;\n    }\n  }\n\n  if (options.release === undefined) {\n    const detectedRelease = getSentryRelease();\n    if (detectedRelease !== undefined) {\n      options.release = detectedRelease;\n    } else {\n      // If release is not provided, then we should disable autoSessionTracking\n      options.autoSessionTracking = false;\n    }\n  }\n\n  options.environment =\n    options.environment || process.env.SENTRY_ENVIRONMENT || getVercelEnv(false) || process.env.NODE_ENV;\n\n  if (options.autoSessionTracking === undefined && options.dsn !== undefined) {\n    options.autoSessionTracking = true;\n  }\n\n  const clientOptions: VercelEdgeClientOptions = {\n    ...options,\n    stackParser: stackParserFromStackParserOptions(options.stackParser || nodeStackParser),\n    integrations: getIntegrationsToSetup(options),\n    transport: options.transport || makeEdgeTransport,\n  };\n\n  return initAndBind(VercelEdgeClient, clientOptions);\n}\n\n/**\n * Returns a release dynamically from environment variables.\n */\n// eslint-disable-next-line complexity\nexport function getSentryRelease(fallback?: string): string | undefined {\n  // Always read first as Sentry takes this as precedence\n  if (process.env.SENTRY_RELEASE) {\n    return process.env.SENTRY_RELEASE;\n  }\n\n  // This supports the variable that sentry-webpack-plugin injects\n  if (GLOBAL_OBJ.SENTRY_RELEASE && GLOBAL_OBJ.SENTRY_RELEASE.id) {\n    return GLOBAL_OBJ.SENTRY_RELEASE.id;\n  }\n\n  // This list is in approximate alpha order, separated into 3 categories:\n  // 1. Git providers\n  // 2. CI providers with specific environment variables (has the provider name in the variable name)\n  // 3. CI providers with generic environment variables (checked for last to prevent possible false positives)\n\n  const possibleReleaseNameOfGitProvider =\n    // GitHub Actions - https://help.github.com/en/actions/configuring-and-managing-workflows/using-environment-variables#default-environment-variables\n    process.env['GITHUB_SHA'] ||\n    // GitLab CI - https://docs.gitlab.com/ee/ci/variables/predefined_variables.html\n    process.env['CI_MERGE_REQUEST_SOURCE_BRANCH_SHA'] ||\n    process.env['CI_BUILD_REF'] ||\n    process.env['CI_COMMIT_SHA'] ||\n    // Bitbucket - https://support.atlassian.com/bitbucket-cloud/docs/variables-and-secrets/\n    process.env['BITBUCKET_COMMIT'];\n\n  const possibleReleaseNameOfCiProvidersWithSpecificEnvVar =\n    // AppVeyor - https://www.appveyor.com/docs/environment-variables/\n    process.env['APPVEYOR_PULL_REQUEST_HEAD_COMMIT'] ||\n    process.env['APPVEYOR_REPO_COMMIT'] ||\n    // AWS CodeBuild - https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-env-vars.html\n    process.env['CODEBUILD_RESOLVED_SOURCE_VERSION'] ||\n    // AWS Amplify - https://docs.aws.amazon.com/amplify/latest/userguide/environment-variables.html\n    process.env['AWS_COMMIT_ID'] ||\n    // Azure Pipelines - https://docs.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&tabs=yaml\n    process.env['BUILD_SOURCEVERSION'] ||\n    // Bitrise - https://devcenter.bitrise.io/builds/available-environment-variables/\n    process.env['GIT_CLONE_COMMIT_HASH'] ||\n    // Buddy CI - https://buddy.works/docs/pipelines/environment-variables#default-environment-variables\n    process.env['BUDDY_EXECUTION_REVISION'] ||\n    // Builtkite - https://buildkite.com/docs/pipelines/environment-variables\n    process.env['BUILDKITE_COMMIT'] ||\n    // CircleCI - https://circleci.com/docs/variables/\n    process.env['CIRCLE_SHA1'] ||\n    // Cirrus CI - https://cirrus-ci.org/guide/writing-tasks/#environment-variables\n    process.env['CIRRUS_CHANGE_IN_REPO'] ||\n    // Codefresh - https://codefresh.io/docs/docs/codefresh-yaml/variables/\n    process.env['CF_REVISION'] ||\n    // Codemagic - https://docs.codemagic.io/yaml-basic-configuration/environment-variables/\n    process.env['CM_COMMIT'] ||\n    // Cloudflare Pages - https://developers.cloudflare.com/pages/platform/build-configuration/#environment-variables\n    process.env['CF_PAGES_COMMIT_SHA'] ||\n    // Drone - https://docs.drone.io/pipeline/environment/reference/\n    process.env['DRONE_COMMIT_SHA'] ||\n    // Flightcontrol - https://www.flightcontrol.dev/docs/guides/flightcontrol/environment-variables#built-in-environment-variables\n    process.env['FC_GIT_COMMIT_SHA'] ||\n    // Heroku #1 https://devcenter.heroku.com/articles/heroku-ci\n    process.env['HEROKU_TEST_RUN_COMMIT_VERSION'] ||\n    // Heroku #2 https://docs.sentry.io/product/integrations/deployment/heroku/#configure-releases\n    process.env['HEROKU_SLUG_COMMIT'] ||\n    // Render - https://render.com/docs/environment-variables\n    process.env['RENDER_GIT_COMMIT'] ||\n    // Semaphore CI - https://docs.semaphoreci.com/ci-cd-environment/environment-variables\n    process.env['SEMAPHORE_GIT_SHA'] ||\n    // TravisCI - https://docs.travis-ci.com/user/environment-variables/#default-environment-variables\n    process.env['TRAVIS_PULL_REQUEST_SHA'] ||\n    // Vercel - https://vercel.com/docs/v2/build-step#system-environment-variables\n    process.env['VERCEL_GIT_COMMIT_SHA'] ||\n    process.env['VERCEL_GITHUB_COMMIT_SHA'] ||\n    process.env['VERCEL_GITLAB_COMMIT_SHA'] ||\n    process.env['VERCEL_BITBUCKET_COMMIT_SHA'] ||\n    // Zeit (now known as Vercel)\n    process.env['ZEIT_GITHUB_COMMIT_SHA'] ||\n    process.env['ZEIT_GITLAB_COMMIT_SHA'] ||\n    process.env['ZEIT_BITBUCKET_COMMIT_SHA'];\n\n  const possibleReleaseNameOfCiProvidersWithGenericEnvVar =\n    // CloudBees CodeShip - https://docs.cloudbees.com/docs/cloudbees-codeship/latest/pro-builds-and-configuration/environment-variables\n    process.env['CI_COMMIT_ID'] ||\n    // Coolify - https://coolify.io/docs/knowledge-base/environment-variables\n    process.env['SOURCE_COMMIT'] ||\n    // Heroku #3 https://devcenter.heroku.com/changelog-items/630\n    process.env['SOURCE_VERSION'] ||\n    // Jenkins - https://plugins.jenkins.io/git/#environment-variables\n    process.env['GIT_COMMIT'] ||\n    // Netlify - https://docs.netlify.com/configure-builds/environment-variables/#build-metadata\n    process.env['COMMIT_REF'] ||\n    // TeamCity - https://www.jetbrains.com/help/teamcity/predefined-build-parameters.html\n    process.env['BUILD_VCS_NUMBER'] ||\n    // Woodpecker CI - https://woodpecker-ci.org/docs/usage/environment\n    process.env['CI_COMMIT_SHA'];\n\n  return (\n    possibleReleaseNameOfGitProvider ||\n    possibleReleaseNameOfCiProvidersWithSpecificEnvVar ||\n    possibleReleaseNameOfCiProvidersWithGenericEnvVar ||\n    fallback\n  );\n}\n"],"names":[],"mappings":"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"}